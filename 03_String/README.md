[MindMap](./String.png)
[demo](./demo.cpp)


# C++ 深度解析：字符串处理 (Strings & Text Processing)

> **核心摘要**：字符串本质上是内存中连续排列的字符数组。C++ 提供了两种主要的字符串处理方式：底层的 **C-Style Strings** (关注内存与指针) 和 高层的 **`std::string`** (关注安全与便捷)。

## 1. 字符串的本质 (The Nature of Strings)
* **物理结构**：内存中连续分配的字节块。
* **基本组成**：字母、数字、符号的集合。
* **存储单元**：通常基于 `char` (1 byte)，但在国际化场景下涉及 `wchar_t` 或 `char16_t` 等宽字符。

## 2. C 风格字符串 (C-Style Strings) - "原生与危险"
这是 C++ 从 C 语言继承来的原生形式，本质是 **指针操作**。

* **定义**：`char str[] = "Hello";` 或 `const char* ptr = "Hello";`
* **核心特征：空终止符 (Null Termination `\0`)**
    * 字符串必须以 ASCII 值为 0 的字符 (`'\0'`) 结尾。
    * 函数（如 `strlen`, `cout`）通过寻找 `\0` 来确定字符串在哪里结束。
    * **风险**：如果丢失 `\0`，程序会越界读取内存，导致崩溃或乱码。
* **类型区分**：
    * `char[]`：栈上分配的数组，内容**可变**。
    * `const char*`：指向常量区的指针（通常指向字符串字面量），内容**不可变**，尝试修改会导致运行时错误 (Segmentation Fault)。

## 3. 标准库字符串 `std::string` - "现代与安全"
C++ 标准库提供的类，位于 `<string>` 头文件中。它是现代 C++ 开发的首选。

* **本质**：`std::basic_string<char>` 的模板特化。它是对动态数组的封装（RAII）。
* **优势**：
    * **自动内存管理**：无需手动 `new`/`delete`，自动扩容。
    * **安全性**：提供 `.at()` 进行边界检查，避免缓冲区溢出。
    * **丰富 API**：内置 `size()`, `find()`, `substr()`, `append()` 等常用算法。
* **底层机制拓展 (SSO - Small String Optimization)**：
    * 大多数现代编译器（GCC, Clang, MSVC）对 `std::string` 进行了优化。
    * **短字符串**（通常 < 15 或 22 字节）直接存储在对象本身的栈内存中，不进行堆分配（Heap Allocation）。
    * **长字符串** 才会在堆上动态分配内存。

## 4. 字符编码与宽字符 (Encodings)
思维导图提到了编码限制，这里做进一步拓展：

* **`char`**: 1 字节。适合 ASCII 和 UTF-8（变长编码的基础单元）。
* **`wchar_t`**: 宽字符。Windows 上通常 2 字节 (UTF-16)，Linux 上通常 4 字节 (UTF-32)。
* **C++11/20 新增类型**：
    * `char8_t` (C++20): 明确用于 UTF-8。
    * `char16_t`: 明确用于 UTF-16。
    * `char32_t`: 明确用于 UTF-32。
* **常见痛点**：`char` 只有 256 种可能，无法单字节表示中文。中文在 UTF-8 中通常占用 3 个 `char`。

## 5. 最佳实践与 C++17 拓展 (Best Practices)

### A. 函数传参
* **原则**：避免不必要的深拷贝。
* **写法**：`void process(const std::string& str);`
* **解释**：使用 `const` 引用，既避免了复制整个字符串（性能高），又保证了函数内部不会修改原字符串（安全）。

### B. 避免拷贝的新神器：`std::string_view` (C++17)
* **痛点**：当你有一个 `char*` 或者 `std::string` 的子串时，转为 `std::string` 通常会发生内存分配和拷贝。
* **解决**：`std::string_view` 是一个**轻量级的“观察者”**。它只有两个成员：指向字符串起点的指针 + 长度。
* **特点**：**零拷贝 (Zero-Copy)**，不拥有内存，只读。非常适合作为函数参数。

### C. 互操作性
* 如果旧的 C 语言 API 需要 `const char*`，使用 `.c_str()` 方法获取。

---